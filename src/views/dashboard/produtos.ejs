<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Produtos - <%= store.store_name %></title>
  <link rel="stylesheet" href="/css/nuvemshop-admin.css">
  <style>
    .product-image-thumb {
      width: 48px;
      height: 48px;
      object-fit: cover;
      border-radius: 6px;
      background: #f8f9fa;
    }
    
    .product-info {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .product-info-text h4 {
      font-size: 14px;
      font-weight: 600;
      margin: 0 0 4px 0;
      color: #1a1d1f;
    }
    
    .product-info-text p {
      font-size: 12px;
      color: #6f767e;
      margin: 0;
      max-width: 300px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .variants-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
    }
    
    .variant-tag {
      display: inline-block;
      padding: 2px 8px;
      background: #f8f9fa;
      border: 1px solid #e5e7eb;
      border-radius: 4px;
      font-size: 11px;
      color: #6f767e;
    }
    
    .actions-cell {
      display: flex;
      gap: 8px;
      justify-content: flex-end;
    }
    
    .empty-products {
      text-align: center;
      padding: 64px 32px;
    }
    
    .empty-products svg {
      margin: 0 auto 24px;
      opacity: 0.3;
    }
    
    .empty-products h3 {
      font-size: 18px;
      font-weight: 600;
      color: #6f767e;
      margin-bottom: 8px;
    }
    
    .empty-products p {
      color: #9ca3af;
      margin-bottom: 24px;
    }
    
    .filters-bar {
      display: flex;
      gap: 12px;
      margin-bottom: 24px;
      flex-wrap: wrap;
    }
    
    .filters-bar input[type="search"] {
      flex: 1;
      min-width: 250px;
    }
    
    .filters-bar select {
      min-width: 150px;
    }
  </style>
</head>
<body>
  <div class="admin-container">
    <!-- Sidebar -->
    <aside class="admin-sidebar">
      <div class="sidebar-header">
        <a href="/dashboard" class="sidebar-logo">CJota Admin</a>
      </div>
      
      <nav class="sidebar-nav">
        <div class="nav-section">
          <div class="nav-section-title">Principal</div>
          <a href="/dashboard" class="nav-item">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="7" height="7"></rect>
              <rect x="14" y="3" width="7" height="7"></rect>
              <rect x="14" y="14" width="7" height="7"></rect>
              <rect x="3" y="14" width="7" height="7"></rect>
            </svg>
            Dashboard
          </a>
          <a href="/dashboard/produtos" class="nav-item active">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 3h18v18H3z"></path>
              <path d="M3 9h18"></path>
              <path d="M9 21V9"></path>
            </svg>
            Produtos
          </a>
          <a href="/dashboard/orders" class="nav-item">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 2L3 8v13h18V8l-6-6H9z"></path>
              <polyline points="9 8 9 2 15 2 15 8"></polyline>
            </svg>
            Pedidos
          </a>
        </div>
        
        <div class="nav-section">
          <div class="nav-section-title">Configurações</div>
          <a href="/dashboard/store-settings" class="nav-item">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 2v4m0 12v4m8-10h-4m-12 0H0m15.364 6.364l-2.828-2.828m-8.486 0L1.222 18.364M18.364 5.636l-2.828 2.828m-8.486 0L4.222 5.636"></path>
              <circle cx="12" cy="12" r="3"></circle>
            </svg>
            Loja
          </a>
          <a href="/dashboard/branding" class="nav-item">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="2" y="3" width="20" height="14" rx="2"></rect>
              <line x1="8" y1="21" x2="16" y2="21"></line>
              <line x1="12" y1="17" x2="12" y2="21"></line>
            </svg>
            Personalização
          </a>
        </div>
      </nav>
    </aside>
    
    <!-- Conteúdo Principal -->
    <main class="admin-main">
      <header class="admin-header">
        <h1 class="page-title">Produtos</h1>
        <div class="header-actions">
          <button class="btn btn-primary" onclick="alert('Funcionalidade em desenvolvimento')">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 8px;">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            Adicionar produto
          </button>
        </div>
      </header>
      
      <div class="admin-content">
        
        <% if (products.length > 0) { %>
          <!-- Barra de Filtros -->
          <div class="filters-bar">
            <input 
              type="search" 
              class="form-input" 
              placeholder="Buscar produtos..."
              id="search-input"
              onkeyup="filterProducts()"
            >
            <select class="form-input" id="status-filter" onchange="filterProducts()">
              <option value="">Todos os status</option>
              <option value="1">Ativos</option>
              <option value="0">Inativos</option>
            </select>
          </div>
          
          <!-- Tabela de Produtos -->
          <div class="card">
            <div class="card-body" style="padding: 0;">
              <div class="table-container">
                <table class="data-table" id="products-table">
                  <thead>
                    <tr>
                      <th style="width: 60px;"></th>
                      <th>Produto</th>
                      <th>SKU</th>
                      <th>Status</th>
                      <th>Estoque</th>
                      <th>Preço</th>
                      <th>Variações</th>
                      <th style="text-align: right;">Ações</th>
                    </tr>
                  </thead>
                  <tbody>
                    <% products.forEach(product => { %>
                      <tr data-active="<%= product.active %>" data-name="<%= product.name.toLowerCase() %>" data-sku="<%= product.sku ? product.sku.toLowerCase() : '' %>">
                        <td>
                          <% if (product.image_url) { %>
                            <img src="<%= product.image_url %>" alt="<%= product.name %>" class="product-image-thumb">
                          <% } else { %>
                            <div class="product-image-thumb" style="display: flex; align-items: center; justify-content: center; color: #c8ccd0;">
                              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="18" height="18" rx="2"></rect>
                                <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                <path d="M21 15l-5-5L5 21"></path>
                              </svg>
                            </div>
                          <% } %>
                        </td>
                        <td>
                          <div class="product-info-text">
                            <h4><%= product.name %></h4>
                            <% if (product.description) { %>
                              <p><%= product.description %></p>
                            <% } %>
                          </div>
                        </td>
                        <td>
                          <% if (product.sku) { %>
                            <code style="font-size: 12px; color: #6f767e;"><%= product.sku %></code>
                          <% } else { %>
                            <span style="color: #c8ccd0;">-</span>
                          <% } %>
                        </td>
                        <td>
                          <% if (product.active) { %>
                            <span class="badge badge-success">Ativo</span>
                          <% } else { %>
                            <span class="badge badge-neutral">Inativo</span>
                          <% } %>
                        </td>
                        <td>
                          <% if (product.stock_quantity !== null && product.stock_quantity !== undefined) { %>
                            <%= product.stock_quantity %>
                          <% } else { %>
                            <span style="color: #c8ccd0;">-</span>
                          <% } %>
                        </td>
                        <td>
                          <% if (product.price_cents) { %>
                            <strong>R$ <%= (product.price_cents / 100).toFixed(2).replace('.', ',') %></strong>
                          <% } else { %>
                            <span style="color: #c8ccd0;">Consultar</span>
                          <% } %>
                        </td>
                        <td>
                          <div class="variants-tags">
                            <% if (product.sizes) { %>
                              <% product.sizes.split(',').filter(s => s).forEach(size => { %>
                                <span class="variant-tag"><%= size %></span>
                              <% }) %>
                            <% } %>
                            <% if (product.colors) { %>
                              <% product.colors.split(',').filter(c => c).forEach(color => { %>
                                <span class="variant-tag"><%= color %></span>
                              <% }) %>
                            <% } %>
                            <% if (!product.sizes && !product.colors) { %>
                              <span style="color: #c8ccd0; font-size: 12px;">Sem variações</span>
                            <% } %>
                          </div>
                        </td>
                        <td>
                          <div class="actions-cell">
                            <button class="btn btn-sm btn-secondary" onclick="alert('Funcionalidade em desenvolvimento')">Editar</button>
                            <button class="btn btn-sm btn-secondary" onclick="alert('Funcionalidade em desenvolvimento')">
                              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="3 6 5 6 21 6"></polyline>
                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                              </svg>
                            </button>
                          </div>
                        </td>
                      </tr>
                    <% }) %>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        <% } else { %>
          <!-- Estado Vazio -->
          <div class="card">
            <div class="card-body empty-products">
              <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 3h18v18H3z"></path>
                <path d="M3 9h18"></path>
                <path d="M9 21V9"></path>
              </svg>
              <h3>Nenhum produto cadastrado</h3>
              <p>Adicione produtos para começar a vender no seu catálogo.</p>
              <button class="btn btn-primary" onclick="alert('Funcionalidade em desenvolvimento')">
                Adicionar primeiro produto
              </button>
            </div>
          </div>
        <% } %>
        
      </div>
    </main>
  </div>

  <script>
    function filterProducts() {
      const searchTerm = document.getElementById('search-input').value.toLowerCase();
      const statusFilter = document.getElementById('status-filter').value;
      const rows = document.querySelectorAll('#products-table tbody tr');
      
      rows.forEach(row => {
        const name = row.dataset.name || '';
        const sku = row.dataset.sku || '';
        const active = row.dataset.active;
        
        const matchesSearch = name.includes(searchTerm) || sku.includes(searchTerm);
        const matchesStatus = !statusFilter || active === statusFilter;
        
        if (matchesSearch && matchesStatus) {
          row.style.display = '';
        } else {
          row.style.display = 'none';
        }
      });
    }
  </script>
</body>
</html>
